!function(a,b,c){"use strict";function p(a){throw new Error("StarchupTracker --- "+a)}function s(){var a=new XMLHttpRequest;return a.open("GET","https://api.ipify.org/",!1),a.send(null),a.responseText}function u(a,c,d){var e=new Date;e.setTime(e.getTime()+24*d*60*60*1e3);var f="expires="+e.toUTCString();b.cookie=a+"="+c+"; "+f}function v(a){for(var c=a+"=",d=b.cookie.split(";"),e=0;e<d.length;e++){for(var f=d[e];" "==f.charAt(0);)f=f.substring(1);if(0==f.indexOf(c))return f.substring(c.length,f.length)}return""}var d="tracker_device_id",e={customerId:null,agentId:null,deviceId:null,facilityId:null,access_token:null,cleanerIdentifier:null,source:null},f=function(a,b,c){e.cleanerIdentifier=a,e.facilityId=b,e.source=c;var f=v(d);return f&&f.length>0&&(e.deviceId=f),this},g=function(a,d){d&&d!==c||(d=j),a||p("Missing event");var f=t("utm_source"),g=t("utm_medium"),h=t("utm_campaign"),i=b.referrer;f&&f.length>0?a.utmSource=f:i&&i.length>1&&(a.utmSource=i),g&&f.length>0&&(a.utmMedium=g),h&&f.length>0&&(a.utmCampaign=h),e.agentId&&(a.agentId=e.agentId),e.customerId&&(a.customerId=e.customerId),e.deviceId&&(a.deviceId=e.deviceId),e.facilityId&&(a.facilityId=e.facilityId),e.source&&(a.source=e.source),e.deviceId?o("POST","Events",a,d):q(function(b,c){c&&(a.deviceId=c.id),o("POST","Events",a,d)})},h=function(a,b,d,f){f&&f!==c||(f=j),a||b||p("Missing user Id"),d||p("Missing token"),e.access_token=d,e.customerId=a,e.agentId=b;var g=function(c,d){var g={customerId:a,agentId:b};if(d&&d.length>0){var h=d[0].id;g.deviceId=d[0].deviceId,d.forEach(function(a){a.customerId==e.customerId&&a.agentId==e.agentId&&a.id&&a.deviceId&&a.id!==h&&(a.id>h||(h=a.id,g.deviceId=a.deviceId))}),e.deviceId?o("PUT","DeviceData/"+e.deviceId,g,f):(e.deviceId=h,f())}else f()};a?l(g):b&&m(g)},i=function(){e.customerId=null,e.deviceId=null,e.access_token=null,u(d,null,0)};f.prototype.trackEvent=g,f.prototype.logIn=h,f.prototype.logOut=i,f.init=f,a.StarchupTracker=f;var j=function(){},k=function(a,b){b&&b!==c||(b=j);var d={where:a};o("GET","DeviceData",d,b)},l=function(a){e.customerId||p("Missing customerId"),k({customerId:e.customerId,source:e.source},a)},m=function(a){e.agentId||p("Missing agentId"),k({agentId:e.agentId,source:e.source},a)},n=function(){var b=a.location.hostname;return a.location.port.length>0&&(b=b.replace(":"+a.location.port,"")),"localhost"===b?"http://dev.starchup.com:3005/api":"dev.starchup.com"===b?"http://dev.starchup.com:3005/api":"stage.starchup.com"===b?"https://stage.starchup.com:3004/api":"https://tracker.starchup.com/api"},o=function(a,b,d,f){f&&f!==c||(f=j),a||p("Missing method"),b||p("Missing resource"),d||p("Missing data");var g=n(),h=g+"/"+b;d&&(d=JSON.stringify(d)),e.access_token&&(h=h+"?access_token="+e.access_token),"GET"===a&&d&&(h=h+(e.access_token?"&":"?")+"filter="+d);var i=new XMLHttpRequest;i.onreadystatechange=function(){4===this.readyState&&(200!=this.status?f():f(null,JSON.parse(this.responseText)))},i.open(a,h,!0),i.setRequestHeader("Content-type","application/json"),i.send("GET"!==a?d:null)},q=function(a){a&&a!==c||(a=j);var b=w();e.customerId&&(b.customerId=e.customerId),e.agentId&&(b.agentId=e.agentId),e.source&&(b.source=e.source),b.deviceId=r(),b.ip=s(),b.identifier=e.cleanerIdentifier,o("POST","DeviceData",b,function(b,c){c&&c.id&&(e.deviceId=c.id,u(d,c.id,.5)),a(b,c)})},r=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},t=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},w=function(){var d,e,f,a=navigator.userAgent,b=navigator.appName,c=""+parseFloat(navigator.appVersion);return(e=a.indexOf("Opera"))!=-1?(b="Opera",c=a.substring(e+6),(e=a.indexOf("Version"))!=-1&&(c=a.substring(e+8))):(e=a.indexOf("MSIE"))!=-1?(b="Microsoft Internet Explorer",c=a.substring(e+5)):(e=a.indexOf("Chrome"))!=-1?(b="Chrome",c=a.substring(e+7)):(e=a.indexOf("Safari"))!=-1?(b="Safari",c=a.substring(e+7),(e=a.indexOf("Version"))!=-1&&(c=a.substring(e+8))):(e=a.indexOf("Firefox"))!=-1?(b="Firefox",c=a.substring(e+8)):(d=a.lastIndexOf(" ")+1)<(e=a.lastIndexOf("/"))&&(b=a.substring(d,e),c=a.substring(e+1),b.toLowerCase()==b.toUpperCase()&&(b=navigator.appName)),(f=c.indexOf(";"))!=-1&&(c=c.substring(0,f)),(f=c.indexOf(" "))!=-1&&(c=c.substring(0,f)),{browser:b,browserVersion:c,os:x()}},x=function(){return navigator.appVersion.indexOf("Win")!=-1?"Windows":navigator.appVersion.indexOf("Mac")!=-1?"MacOS":navigator.appVersion.indexOf("X11")!=-1?"UNIX":navigator.appVersion.indexOf("Linux")!=-1?"Linux":"Unkown"}}(window,document);