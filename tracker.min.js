!function(c,o,u){"use strict";function e(e,t,n){d.cleanerIdentifier=e,d.facilityId=t,d.source=n;var i=function(e){for(var t=e+"=",n=o.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}(r);return i&&0<i.length&&(d.deviceId=i),this}var r="tracker_device_id",d={customerId:null,agentId:null,deviceId:null,facilityId:null,access_token:null,cleanerIdentifier:null,source:null},l=function(n,i){if(d.busy)return f(function(){l(n,i)});function r(e,t){d.busy=!1,i(e,t)}d.busy=!0,i&&i!==u||(i=g),n||v("Missing event");var e=h("utm_source"),t=h("utm_medium"),o=h("utm_campaign"),s=h("utm_term"),c=h("utm_content"),a=h("gclid");e&&0<e.length&&(n.utmSource=e),t&&0<t.length&&(n.utmMedium=t),o&&0<o.length&&(n.utmCampaign=o),s&&0<s.length&&(n.utmTerm=s),c&&0<c.length&&(n.utmContent=c),a&&0<a.length&&(n.gclid=a),d.agentId&&(n.agentId=d.agentId),d.customerId&&(n.customerId=d.customerId),d.deviceId&&(n.deviceId=d.deviceId),d.facilityId&&(n.facilityId=d.facilityId),d.source&&(n.source=d.source),d.deviceId?I("POST","Events",n,r):m(function(e,t){e||!t?r():(n.deviceId=t.id,I("POST","Events",n,r))})},i=function(r,o,e,n){if(d.busy)return f(function(){i(r,o,e,n)});function s(e,t){d.busy=!1,n(e,t)}d.busy=!0,n&&n!==u||(n=g),r||o||v("Missing user Id"),e||v("Missing token"),d.access_token=e,d.customerId=r,d.agentId=o;function t(e,t){if(e||!t)return s();var n,i={customerId:r,agentId:o};t&&0<t.length&&(n=t[0].id,i.deviceId=t[0].deviceId,t.forEach(function(e){e.customerId==d.customerId&&e.agentId==d.agentId&&e.id&&e.deviceId&&e.id!==n&&(e.id>n||(n=e.id,i.deviceId=e.deviceId))}),d.deviceId||(d.deviceId=n)),I("PUT","DeviceData/"+d.deviceId,i,function(e,t){return!e&&t?s():void m(function(e,t){!e&&t&&(d.deviceId=t.id),s()})})}r?a(t):o&&p(t)};e.prototype.trackEvent=l,e.prototype.logIn=i,e.prototype.logOut=function(){d.customerId=null,d.deviceId=null,d.access_token=null,s(r,null,0)},e.init=e,c.StarchupTracker=e;function t(e,t){t&&t!==u||(t=g),I("GET","DeviceData",{where:e},t)}var g=function(){},f=function(e,t){if(10<t)return e();d.busy&&c.setTimeout(function(){e()},100)},a=function(e){d.customerId||v("Missing customerId"),t({customerId:d.customerId,source:d.source},e)},p=function(e){d.agentId||v("Missing agentId"),t({agentId:d.agentId,source:d.source},e)},I=function(e,t,n,i){i&&i!==u||(i=g),e||v("Missing method"),t||v("Missing resource"),n||v("Missing data");var r,o=(r=c.location.hostname,0<c.location.port.length&&(r=r.replace(":"+c.location.port,"")),"localhost"===r?"http://localhost:3000/api":"dev.starchup.com"===r?"http://dev-api.starchup.com:3005/api":"stage.starchup.com"===r?"https://stage-api.starchup.com/api":"https://api.starchup.com/api")+"/"+t;n=n&&JSON.stringify(n),d.access_token&&(o=o+"?access_token="+d.access_token),"GET"===e&&n&&(o=o+(d.access_token?"&":"?")+"filter="+n);var s=new XMLHttpRequest;s.onreadystatechange=function(){4===this.readyState&&(200!=this.status?i():i(null,JSON.parse(this.responseText)))},s.open(e,o,!0),s.setRequestHeader("Content-type","application/json"),s.send("GET"!==e?n:null)};function v(e){throw d.busy=!1,new Error("StarchupTracker --- "+e)}var m=function(n){n&&n!==u||(n=g);var e,t=x();d.customerId&&(t.customerId=d.customerId),d.agentId&&(t.agentId=d.agentId),d.source&&(t.source=d.source),t.ip=((e=new XMLHttpRequest).open("GET","https://api.ipify.org/",!1),e.send(null),e.responseText),t.identifier=d.cleanerIdentifier,I("POST","DeviceData",t,function(e,t){t&&t.id?(d.deviceId=t.id,s(r,t.id,.5)):console.error("Could not create tracking device"),n(e,t)})};var h=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);if(!t||t.length<2)return null;var n=decodeURIComponent(t[1]).replace(/\"/g,"");return!n||n.length<1||-1<n.indexOf("http")?null:"null"!==n?n:void 0};function s(e,t,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var r="expires="+i.toUTCString();o.cookie=e+"="+t+"; "+r}var x=function(){var e,t,n,i=navigator.userAgent,r=navigator.appName,o=""+parseFloat(navigator.appVersion);return-1!=(t=i.indexOf("Opera"))?(r="Opera",o=i.substring(t+6),-1!=(t=i.indexOf("Version"))&&(o=i.substring(t+8))):-1!=(t=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",o=i.substring(t+5)):-1!=(t=i.indexOf("Chrome"))?(r="Chrome",o=i.substring(t+7)):-1!=(t=i.indexOf("Safari"))?(r="Safari",o=i.substring(t+7),-1!=(t=i.indexOf("Version"))&&(o=i.substring(t+8))):-1!=(t=i.indexOf("Firefox"))?(r="Firefox",o=i.substring(t+8)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(r=i.substring(e,t),o=i.substring(t+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName)),-1!=(n=o.indexOf(";"))&&(o=o.substring(0,n)),-1!=(n=o.indexOf(" "))&&(o=o.substring(0,n)),{browser:r,browserVersion:o,os:O()}},O=function(){return-1!=navigator.appVersion.indexOf("Win")?"Windows":-1!=navigator.appVersion.indexOf("Mac")?"MacOS":-1!=navigator.appVersion.indexOf("X11")?"UNIX":-1!=navigator.appVersion.indexOf("Linux")?"Linux":"Unkown"}}(window,document);