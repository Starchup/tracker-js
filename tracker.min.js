!function(e,t,n){"use strict";var i="tracker_device_id",r={customerId:null,agentId:null,deviceId:null,facilityId:null,access_token:null,cleanerIdentifier:null,source:null},o=function(e,n,o){r.cleanerIdentifier=e,r.facilityId=n,r.source=o;var s=function(e){for(var n=e+"=",i=t.cookie.split(";"),r=0;r<i.length;r++){for(var o=i[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(n))return o.substring(n.length,o.length)}return""}(i);return s&&s.length>0&&(r.deviceId=s),this},s=function(e,i){if(r.busy)return u(function(){s(e,i)});function o(e,t){r.busy=!1,i(e,t)}r.busy=!0,i&&i!==n||(i=a),e||p("Missing event");var c=v("utm_source"),d=v("utm_medium"),l=v("utm_campaign"),f=v("utm_term"),m=v("utm_content"),h=t.referrer;c&&c.length>0?e.utmSource=c:h&&h.length>1&&(e.utmSource=h),d&&d.length>0&&(e.utmMedium=d),l&&l.length>0&&(e.utmCampaign=l),f&&f.length>0&&(e.utmTerm=f),m&&m.length>0&&(e.utmContent=m),r.agentId&&(e.agentId=r.agentId),r.customerId&&(e.customerId=r.customerId),r.deviceId&&(e.deviceId=r.deviceId),r.facilityId&&(e.facilityId=r.facilityId),r.source&&(e.source=r.source),r.deviceId?g("POST","Events",e,o):I(function(t,n){t||!n?o():(e.deviceId=n.id,g("POST","Events",e,o))})},c=function(e,t,i,o){if(r.busy)return u(function(){c(e,t,i,o)});function s(e,t){r.busy=!1,o(e,t)}r.busy=!0,o&&o!==n||(o=a),e||t||p("Missing user Id"),i||p("Missing token"),r.access_token=i,r.customerId=e,r.agentId=t;var d=function(n,i){if(n||!i)return s();var o={customerId:e,agentId:t};if(i&&i.length>0){var c=i[0].id;o.deviceId=i[0].deviceId,i.forEach(function(e){e.customerId==r.customerId&&e.agentId==r.agentId&&e.id&&e.deviceId&&e.id!==c&&(e.id>c||(c=e.id,o.deviceId=e.deviceId))}),r.deviceId||(r.deviceId=c)}g("PUT","DeviceData/"+r.deviceId,o,function(e,t){if(!e&&t)return s();I(function(e,t){!e&&t&&(r.deviceId=t.id),s()})})};e?l(d):t&&f(d)};o.prototype.trackEvent=s,o.prototype.logIn=c,o.prototype.logOut=function(){r.customerId=null,r.deviceId=null,r.access_token=null,m(i,null,0)},o.init=o,e.StarchupTracker=o;var a=function(){},u=function(t,n){if(n>10)return t();r.busy&&e.setTimeout(function(){t()},100)},d=function(e,t){t&&t!==n||(t=a),g("GET","DeviceData",{where:e},t)},l=function(e){r.customerId||p("Missing customerId"),d({customerId:r.customerId,source:r.source},e)},f=function(e){r.agentId||p("Missing agentId"),d({agentId:r.agentId,source:r.source},e)},g=function(t,i,o,s){s&&s!==n||(s=a),t||p("Missing method"),i||p("Missing resource"),o||p("Missing data");var c,u=(c=e.location.hostname,e.location.port.length>0&&(c=c.replace(":"+e.location.port,"")),"localhost"===c?"http://localhost:3000/api":"dev.starchup.com"===c?"http://dev.starchup.com:3005/api":"stage.starchup.com"===c?"https://sandbox.starchup.com/api":"https://api.starchup.com/api")+"/"+i;o&&(o=JSON.stringify(o)),r.access_token&&(u=u+"?access_token="+r.access_token),"GET"===t&&o&&(u=u+(r.access_token?"&":"?")+"filter="+o);var d=new XMLHttpRequest;d.onreadystatechange=function(){4===this.readyState&&(200!=this.status?s():s(null,JSON.parse(this.responseText)))},d.open(t,u,!0),d.setRequestHeader("Content-type","application/json"),d.send("GET"!==t?o:null)};function p(e){throw r.busy=!1,new Error("StarchupTracker --- "+e)}var I=function(e){e&&e!==n||(e=a);var t,o=h();r.customerId&&(o.customerId=r.customerId),r.agentId&&(o.agentId=r.agentId),r.source&&(o.source=r.source),o.ip=((t=new XMLHttpRequest).open("GET","https://api.ipify.org/",!1),t.send(null),t.responseText),o.identifier=r.cleanerIdentifier,g("POST","DeviceData",o,function(t,n){n&&n.id?(r.deviceId=n.id,m(i,n.id,.5)):console.error("Could not create tracking device"),e(t,n)})};var v=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);if(!t||t.length<1)return null;if(t.indexOf("http"))return null;var n=decodeURIComponent(t[1].replace(/\+/g," "));return!n||n.length<1?null:n.indexOf("http")?null:void 0};function m(e,n,i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3);var o="expires="+r.toUTCString();t.cookie=e+"="+n+"; "+o}var h=function(){var e,t,n,i=navigator.userAgent,r=navigator.appName,o=""+parseFloat(navigator.appVersion);return-1!=(t=i.indexOf("Opera"))?(r="Opera",o=i.substring(t+6),-1!=(t=i.indexOf("Version"))&&(o=i.substring(t+8))):-1!=(t=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",o=i.substring(t+5)):-1!=(t=i.indexOf("Chrome"))?(r="Chrome",o=i.substring(t+7)):-1!=(t=i.indexOf("Safari"))?(r="Safari",o=i.substring(t+7),-1!=(t=i.indexOf("Version"))&&(o=i.substring(t+8))):-1!=(t=i.indexOf("Firefox"))?(r="Firefox",o=i.substring(t+8)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(r=i.substring(e,t),o=i.substring(t+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName)),-1!=(n=o.indexOf(";"))&&(o=o.substring(0,n)),-1!=(n=o.indexOf(" "))&&(o=o.substring(0,n)),{browser:r,browserVersion:o,os:x()}},x=function(){return-1!=navigator.appVersion.indexOf("Win")?"Windows":-1!=navigator.appVersion.indexOf("Mac")?"MacOS":-1!=navigator.appVersion.indexOf("X11")?"UNIX":-1!=navigator.appVersion.indexOf("Linux")?"Linux":"Unkown"}}(window,document);