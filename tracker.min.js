!function(c,o,u){"use strict";var r="tracker_device_id",d={customerId:null,agentId:null,deviceId:null,facilityId:null,access_token:null,cleanerIdentifier:null,source:null},e=function(e,n,t){d.cleanerIdentifier=e,d.facilityId=n,d.source=t;var i=function(e){for(var n=e+"=",t=o.cookie.split(";"),i=0;i<t.length;i++){for(var r=t[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(n))return r.substring(n.length,r.length)}return""}(r);return i&&0<i.length&&(d.deviceId=i),this},l=function(t,i){if(d.busy)return g(function(){l(t,i)});function r(e,n){d.busy=!1,i(e,n)}d.busy=!0,i&&i!==u||(i=f),t||v("Missing event");var e=h("utm_source"),n=h("utm_medium"),o=h("utm_campaign"),s=h("utm_term"),c=h("utm_content"),a=h("gclid");e&&0<e.length&&(t.utmSource=e),n&&0<n.length&&(t.utmMedium=n),o&&0<o.length&&(t.utmCampaign=o),s&&0<s.length&&(t.utmTerm=s),c&&0<c.length&&(t.utmContent=c),a&&0<a.length&&(t.gclid=a),d.agentId&&(t.agentId=d.agentId),d.customerId&&(t.customerId=d.customerId),d.deviceId&&(t.deviceId=d.deviceId),d.facilityId&&(t.facilityId=d.facilityId),d.source&&(t.source=d.source),d.deviceId?I("POST","Events",t,r):m(function(e,n){e||!n?r():(t.deviceId=n.id,I("POST","Events",t,r))})},i=function(r,o,e,t){if(d.busy)return g(function(){i(r,o,e,t)});function s(e,n){d.busy=!1,t(e,n)}d.busy=!0,t&&t!==u||(t=f),r||o||v("Missing user Id"),e||v("Missing token"),d.access_token=e,d.customerId=r,d.agentId=o;var n=function(e,n){if(e||!n)return s();var t={customerId:r,agentId:o};if(n&&0<n.length){var i=n[0].id;t.deviceId=n[0].deviceId,n.forEach(function(e){e.customerId==d.customerId&&e.agentId==d.agentId&&e.id&&e.deviceId&&e.id!==i&&(e.id>i||(i=e.id,t.deviceId=e.deviceId))}),d.deviceId||(d.deviceId=i)}I("PUT","DeviceData/"+d.deviceId,t,function(e,n){if(!e&&n)return s();m(function(e,n){!e&&n&&(d.deviceId=n.id),s()})})};r?a(n):o&&p(n)};e.prototype.trackEvent=l,e.prototype.logIn=i,e.prototype.logOut=function(){d.customerId=null,d.deviceId=null,d.access_token=null,s(r,null,0)},e.init=e,c.StarchupTracker=e;var f=function(){},g=function(e,n){if(10<n)return e();d.busy&&c.setTimeout(function(){e()},100)},n=function(e,n){n&&n!==u||(n=f),I("GET","DeviceData",{where:e},n)},a=function(e){d.customerId||v("Missing customerId"),n({customerId:d.customerId,source:d.source},e)},p=function(e){d.agentId||v("Missing agentId"),n({agentId:d.agentId,source:d.source},e)},I=function(e,n,t,i){i&&i!==u||(i=f),e||v("Missing method"),n||v("Missing resource"),t||v("Missing data");var r,o=(r=c.location.hostname,0<c.location.port.length&&(r=r.replace(":"+c.location.port,"")),"localhost"===r?"http://localhost:3000/api":"dev.starchup.com"===r?"http://dev.starchup.com:3005/api":"stage.starchup.com"===r?"https://sandbox.starchup.com/api":"https://api.starchup.com/api")+"/"+n;t&&(t=JSON.stringify(t)),d.access_token&&(o=o+"?access_token="+d.access_token),"GET"===e&&t&&(o=o+(d.access_token?"&":"?")+"filter="+t);var s=new XMLHttpRequest;s.onreadystatechange=function(){4===this.readyState&&(200!=this.status?i():i(null,JSON.parse(this.responseText)))},s.open(e,o,!0),s.setRequestHeader("Content-type","application/json"),s.send("GET"!==e?t:null)};function v(e){throw d.busy=!1,new Error("StarchupTracker --- "+e)}var m=function(t){t&&t!==u||(t=f);var e,n=x();d.customerId&&(n.customerId=d.customerId),d.agentId&&(n.agentId=d.agentId),d.source&&(n.source=d.source),n.ip=((e=new XMLHttpRequest).open("GET","https://api.ipify.org/",!1),e.send(null),e.responseText),n.identifier=d.cleanerIdentifier,I("POST","DeviceData",n,function(e,n){n&&n.id?(d.deviceId=n.id,s(r,n.id,.5)):console.error("Could not create tracking device"),t(e,n)})};var h=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);if(!n||n.length<2)return null;var t=decodeURIComponent(n[1]).replace(/\"/g,"");return!t||t.length<1?null:-1<t.indexOf("http")?null:"null"!==t?t:void 0};function s(e,n,t){var i=new Date;i.setTime(i.getTime()+24*t*60*60*1e3);var r="expires="+i.toUTCString();o.cookie=e+"="+n+"; "+r}var x=function(){var e,n,t,i=navigator.userAgent,r=navigator.appName,o=""+parseFloat(navigator.appVersion);return-1!=(n=i.indexOf("Opera"))?(r="Opera",o=i.substring(n+6),-1!=(n=i.indexOf("Version"))&&(o=i.substring(n+8))):-1!=(n=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",o=i.substring(n+5)):-1!=(n=i.indexOf("Chrome"))?(r="Chrome",o=i.substring(n+7)):-1!=(n=i.indexOf("Safari"))?(r="Safari",o=i.substring(n+7),-1!=(n=i.indexOf("Version"))&&(o=i.substring(n+8))):-1!=(n=i.indexOf("Firefox"))?(r="Firefox",o=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(r=i.substring(e,n),o=i.substring(n+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName)),-1!=(t=o.indexOf(";"))&&(o=o.substring(0,t)),-1!=(t=o.indexOf(" "))&&(o=o.substring(0,t)),{browser:r,browserVersion:o,os:O()}},O=function(){return-1!=navigator.appVersion.indexOf("Win")?"Windows":-1!=navigator.appVersion.indexOf("Mac")?"MacOS":-1!=navigator.appVersion.indexOf("X11")?"UNIX":-1!=navigator.appVersion.indexOf("Linux")?"Linux":"Unkown"}}(window,document);