!function(e,t,n){"use strict";function r(e){throw new Error("StarchupTracker --- "+e)}function i(){var e=new XMLHttpRequest;return e.open("GET","https://api.ipify.org/",!1),e.send(null),e.responseText}function o(e,n,r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3);var o="expires="+i.toUTCString();t.cookie=e+"="+n+"; "+o}function s(e){for(var n=e+"=",r=t.cookie.split(";"),i=0;i<r.length;i++){for(var o=r[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(n))return o.substring(n.length,o.length)}return""}var a="tracker_device_id",c={customerId:null,agentId:null,deviceId:null,facilityId:null,access_token:null,cleanerIdentifier:null,source:null},u=function(e,t,n){c.cleanerIdentifier=e,c.facilityId=t,c.source=n;var r=s(a);return r&&r.length>0&&(c.deviceId=r),this},d=function(e,i){i&&i!==n||(i=l),e||r("Missing event");var o=M("utm_source"),s=M("utm_medium"),a=M("utm_campaign"),u=t.referrer;o&&o.length>0?e.utmSource=o:u&&u.length>1&&(e.utmSource=u),s&&o.length>0&&(e.utmMedium=s),a&&o.length>0&&(e.utmCampaign=a),c.agentId&&(e.agentId=c.agentId),c.customerId&&(e.customerId=c.customerId),c.deviceId&&(e.deviceId=c.deviceId),c.facilityId&&(e.facilityId=c.facilityId),c.source&&(e.source=c.source),c.deviceId?h("POST","Events",e,i):x(function(t,n){n&&(e.deviceId=n.id),h("POST","Events",e,i)})},p=function(e,t,i,o){o&&o!==n||(o=l),e||t||r("Missing user Id"),i||r("Missing token"),c.access_token=i,c.customerId=e,c.agentId=t;var s=function(t,n){var r={customerId:e};if(n&&n.length>0){var i=n[0].id;r.deviceId=n[0].deviceId,n.forEach(function(e){e.customerId==c.customerId&&e.agentId==c.agentId&&e.id&&e.deviceId&&e.id!==i&&(e.id>i||(i=e.id,r.deviceId=e.deviceId))})}c.deviceId?h("PUT","DeviceData/"+c.deviceId,r,o):(c.deviceId=r.deviceId,o())};e?I(s):t&&v(s)},g=function(){c.customerId=null,c.deviceId=null,c.access_token=null,o(a,null,0)};u.prototype.trackEvent=d,u.prototype.logIn=p,u.prototype.logOut=g,u.init=u,e.StarchupTracker=u;var l=function(){},f=function(e,t){t&&t!==n||(t=l);var r={where:e};h("GET","DeviceData",r,t)},I=function(e){c.customerId||r("Missing customerId"),f({customerId:c.customerId,source:c.source},e)},v=function(e){c.agentId||r("Missing agentId"),f({agentId:c.agentId,source:c.source},e)},m=function(){var t=e.location.hostname;return e.location.port.length>0&&(t=t.replace(":"+e.location.port,"")),"localhost"===t?"http://dev.starchup.com:3005/api":"dev.starchup.com"===t?"http://dev.starchup.com:3005/api":"stage.starchup.com"===t?"https://stage.starchup.com:3004/api":"https://tracker.starchup.com/api"},h=function(e,t,i,o){o&&o!==n||(o=l),e||r("Missing method"),t||r("Missing resource"),i||r("Missing data");var s=m(),a=s+"/"+t;i&&(i=JSON.stringify(i)),c.access_token&&(a=a+"?access_token="+c.access_token),"GET"===e&&i&&(a=a+(c.access_token?"&":"?")+"filter="+i);var u=new XMLHttpRequest;u.onreadystatechange=function(){4===this.readyState&&(200!=this.status?o():o(null,JSON.parse(this.responseText)))},u.open(e,a,!0),u.setRequestHeader("Content-type","application/json"),u.send("GET"!==e?i:null)},x=function(e){e&&e!==n||(e=l);var t=b();c.customerId&&(t.customerId=c.customerId),c.agentId&&(t.agentId=c.agentId),c.source&&(t.source=c.source),t.deviceId=O(),t.ip=i(),t.app=c.cleanerIdentifier,h("POST","DeviceData",t,function(t,n){n&&n.id&&(c.deviceId=n.id,o(a,n.id,.5)),e(t,n)})},O=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},M=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},b=function(){var e,t,n,r=navigator.userAgent,i=navigator.appName,o=""+parseFloat(navigator.appVersion);return-1!=(t=r.indexOf("Opera"))?(i="Opera",o=r.substring(t+6),-1!=(t=r.indexOf("Version"))&&(o=r.substring(t+8))):-1!=(t=r.indexOf("MSIE"))?(i="Microsoft Internet Explorer",o=r.substring(t+5)):-1!=(t=r.indexOf("Chrome"))?(i="Chrome",o=r.substring(t+7)):-1!=(t=r.indexOf("Safari"))?(i="Safari",o=r.substring(t+7),-1!=(t=r.indexOf("Version"))&&(o=r.substring(t+8))):-1!=(t=r.indexOf("Firefox"))?(i="Firefox",o=r.substring(t+8)):(e=r.lastIndexOf(" ")+1)<(t=r.lastIndexOf("/"))&&(i=r.substring(e,t),o=r.substring(t+1),i.toLowerCase()==i.toUpperCase()&&(i=navigator.appName)),-1!=(n=o.indexOf(";"))&&(o=o.substring(0,n)),-1!=(n=o.indexOf(" "))&&(o=o.substring(0,n)),{browser:i,browserVersion:o,os:k()}},k=function(){return-1!=navigator.appVersion.indexOf("Win")?"Windows":-1!=navigator.appVersion.indexOf("Mac")?"MacOS":-1!=navigator.appVersion.indexOf("X11")?"UNIX":-1!=navigator.appVersion.indexOf("Linux")?"Linux":"Unkown"}}(window,document);