!function(e,t,n){"use strict";function i(e){throw c.busy=!1,new Error("StarchupTracker --- "+e)}function r(){var e=new XMLHttpRequest;return e.open("GET","https://api.ipify.org/",!1),e.send(null),e.responseText}function o(e,n,i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3);var o="expires="+r.toUTCString();t.cookie=e+"="+n+"; "+o}function s(e){for(var n=e+"=",i=t.cookie.split(";"),r=0;r<i.length;r++){for(var o=i[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(n))return o.substring(n.length,o.length)}return""}var c={customerId:null,agentId:null,deviceId:null,facilityId:null,access_token:null,cleanerIdentifier:null,source:null},a=function(e,t,n){c.cleanerIdentifier=e,c.facilityId=t,c.source=n;var i=s("tracker_device_id");return i&&i.length>0&&(c.deviceId=i),this},u=function(e,n){function r(e,t){c.busy=!1,n(e,t)}if(c.busy)return l(function(){u(e,n)});c.busy=!0,n&&void 0!==n||(n=g),e||i("Missing event");var o=O("utm_source"),s=O("utm_medium"),a=O("utm_campaign"),d=t.referrer;o&&o.length>0?e.utmSource=o:d&&d.length>1&&(e.utmSource=d),s&&o.length>0&&(e.utmMedium=s),a&&o.length>0&&(e.utmCampaign=a),c.agentId&&(e.agentId=c.agentId),c.customerId&&(e.customerId=c.customerId),c.deviceId&&(e.deviceId=c.deviceId),c.facilityId&&(e.facilityId=c.facilityId),c.source&&(e.source=c.source),c.deviceId?h("POST","Events",e,r):x(function(t,n){t||!n?r():(e.deviceId=n.id,h("POST","Events",e,r))})},d=function(e,t,n,r){function o(e,t){c.busy=!1,r(e,t)}if(c.busy)return l(function(){d(e,t,n,r)});if(c.busy=!0,r&&void 0!==r||(r=g),e||t||i("Missing user Id"),n||i("Missing token"),c.access_token=n,c.customerId=e,c.agentId=t,c.deviceId)return o();var s=function(n,i){if(n||!i)return o();var r={customerId:e,agentId:t};if(i&&i.length>0){var s=i[0].id;r.deviceId=i[0].deviceId,i.forEach(function(e){e.customerId==c.customerId&&e.agentId==c.agentId&&e.id&&e.deviceId&&e.id!==s&&(e.id>s||(s=e.id,r.deviceId=e.deviceId))}),c.deviceId||(c.deviceId=s)}h("PUT","DeviceData/"+c.deviceId,r,o)};e?I(s):t&&v(s)},f=function(){c.customerId=null,c.deviceId=null,c.access_token=null,o("tracker_device_id",null,0)};a.prototype.trackEvent=u,a.prototype.logIn=d,a.prototype.logOut=f,a.init=a,e.StarchupTracker=a;var g=function(){},l=function(t,n){if(n>10)return t();c.busy&&e.setTimeout(function(){t()},100)},p=function(e,t){t&&void 0!==t||(t=g),h("GET","DeviceData",{where:e},t)},I=function(e){c.customerId||i("Missing customerId"),p({customerId:c.customerId,source:c.source},e)},v=function(e){c.agentId||i("Missing agentId"),p({agentId:c.agentId,source:c.source},e)},m=function(){var t=e.location.hostname;return e.location.port.length>0&&(t=t.replace(":"+e.location.port,"")),"localhost"===t?"http://dev.starchup.com:3005/api":"dev.starchup.com"===t?"http://dev.starchup.com:3005/api":"stage.starchup.com"===t?"https://sandbox-tracker.starchup.com/api":"https://tracker.starchup.com/api"},h=function(e,t,n,r){r&&void 0!==r||(r=g),e||i("Missing method"),t||i("Missing resource"),n||i("Missing data");var o=m()+"/"+t;n&&(n=JSON.stringify(n)),c.access_token&&(o=o+"?access_token="+c.access_token),"GET"===e&&n&&(o=o+(c.access_token?"&":"?")+"filter="+n);var s=new XMLHttpRequest;s.onreadystatechange=function(){4===this.readyState&&(200!=this.status?r():r(null,JSON.parse(this.responseText)))},s.open(e,o,!0),s.setRequestHeader("Content-type","application/json"),s.send("GET"!==e?n:null)},x=function(e){e&&void 0!==e||(e=g);var t=y();c.customerId&&(t.customerId=c.customerId),c.agentId&&(t.agentId=c.agentId),c.source&&(t.source=c.source),t.deviceId=b(),t.ip=r(),t.identifier=c.cleanerIdentifier,h("POST","DeviceData",t,function(t,n){n&&n.id&&(c.deviceId=n.id,o("tracker_device_id",n.id,.5)),e(t,n)})},b=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},O=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},y=function(){var e,t,n,i=navigator.userAgent,r=navigator.appName,o=""+parseFloat(navigator.appVersion);return-1!=(t=i.indexOf("Opera"))?(r="Opera",o=i.substring(t+6),-1!=(t=i.indexOf("Version"))&&(o=i.substring(t+8))):-1!=(t=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",o=i.substring(t+5)):-1!=(t=i.indexOf("Chrome"))?(r="Chrome",o=i.substring(t+7)):-1!=(t=i.indexOf("Safari"))?(r="Safari",o=i.substring(t+7),-1!=(t=i.indexOf("Version"))&&(o=i.substring(t+8))):-1!=(t=i.indexOf("Firefox"))?(r="Firefox",o=i.substring(t+8)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(r=i.substring(e,t),o=i.substring(t+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName)),-1!=(n=o.indexOf(";"))&&(o=o.substring(0,n)),-1!=(n=o.indexOf(" "))&&(o=o.substring(0,n)),{browser:r,browserVersion:o,os:k()}},k=function(){return-1!=navigator.appVersion.indexOf("Win")?"Windows":-1!=navigator.appVersion.indexOf("Mac")?"MacOS":-1!=navigator.appVersion.indexOf("X11")?"UNIX":-1!=navigator.appVersion.indexOf("Linux")?"Linux":"Unkown"}}(window,document);